(this["webpackJsonprtc-test"]=this["webpackJsonprtc-test"]||[]).push([[0],{125:function(e,t,n){},163:function(e,t,n){},164:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),i=n(11),o=n.n(i),a=(n(125),n(60)),s=n(13),u=n(61),l=n(62),d=n(72),j=n(71),b=n(22),f=n.n(b),O=n(45),h=n(20),x=n(36),g=n(212),v=n(213),m=n(214),p=n(215),y=n(216),k=n(217),w=n(232),C=n(211),S=n(209),T=n(210),R=n(227),I=n(2);function D(e){var t=e.open,n=e.message,c=e.label,r=e.setText,i=e.value,o=e.submit;return Object(I.jsxs)(w.a,{open:t,children:[Object(I.jsxs)(S.a,{children:[Object(I.jsx)(T.a,{children:n}),Object(I.jsx)(R.a,{label:c,type:"number",onChange:function(e){var t=Number(e.target.value);t>100&&(t=100),t<1&&(t=1),r(t)},inputProps:{min:1,max:100},value:i})]}),Object(I.jsx)(C.a,{children:Object(I.jsx)(g.a,{onClick:o,color:"primary",children:"\uc785\ub825"})})]})}var E=n(104),B=n(228),M=(Object(E.a)({overrides:{MuiGrid:{container:{height:"100%"}}},palette:{primary:{main:"#38BF87"},secondary:{main:"#ff1a1a"}}}),Object(B.a)((function(){return{roundButton:{borderRadius:"50%",width:"60px",height:"60px"}}}))),N=function(e){var t=e.connections,n=e.setConnections,c=e.setResolution,i=e.audio,o=e.video,a=e.toggleAudio,s=e.toggleVideo,u=e.initCall,l=e.localStream,d=(e.foundLocal,e.isOpen),j=e.setIsOpen,b=M();return Object(I.jsxs)(r.a.Fragment,{children:[Object(I.jsx)("main",{children:Object(I.jsxs)(v.a,{container:!0,id:"await-main",spacing:10,children:[Object(I.jsx)(v.a,{item:!0,children:Object(I.jsxs)("div",{id:"await-video-container",children:[Object(I.jsx)("video",{id:"await-video",ref:l,autoPlay:!0}),Object(I.jsxs)("div",{id:"await-video-controls",children:[Object(I.jsx)(g.a,{variant:"contained",className:b.roundButton,onClick:a,children:i?Object(I.jsx)(m.a,{}):Object(I.jsx)(p.a,{})}),Object(I.jsx)(g.a,{variant:"contained",className:b.roundButton,onClick:s,children:o?Object(I.jsx)(y.a,{}):Object(I.jsx)(k.a,{})})]})]})}),Object(I.jsx)(v.a,{item:!0,className:b.awaitControls,children:Object(I.jsxs)(v.a,{container:!0,direction:"column",spacing:1,alignItems:"center",children:[Object(I.jsx)(v.a,{item:!0,children:Object(I.jsxs)("div",{id:"await-resoultion-controls",children:[Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(0)},children:"qvga"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(1)},children:"vga"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(2)},children:"HD"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(3)},children:"fullHD"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(4)},children:"TV4k"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(5)},children:"cinema4K"}),Object(I.jsx)(g.a,{variant:"contained",onClick:function(){return c(5)},children:"8K"})]})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsxs)(g.a,{onClick:function(){return j(!0)},children:["Connections: ",t]})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsxs)(v.a,{container:!0,spacing:1,children:[Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:b.roundButton,onClick:function(){return n(t+1)},disabled:t>=100,children:"+"})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:b.roundButton,onClick:function(){return n(t-1)},disabled:t<=1,children:"-"})})]})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",onClick:u,children:"\uc9c0\uae08 \ucc38\uc5ec\ud558\uae30"})})]})})]})}),Object(I.jsx)(D,{open:d,message:"Peer \uc218 \uc785\ub825",label:"peer",setText:n,value:t,submit:function(){return j(!1)}})]})},A=n(68),V=n(80),L=n(234),P=n(229),F="rtc/SET_SETTINGS",U=Object(L.a)(F,(function(e){return e})),q=Object(P.a)(Object(A.a)({},F,(function(e,t){var n=t.payload;return Object(V.a)(Object(V.a)({},e),{},{setting:n})})),{setting:{connections:1,audio:!0,video:!0,resolution:{width:{exact:320},height:{exact:240}}}}),H=[{width:{exact:320},height:{exact:240}},{width:{exact:640},height:{exact:480}},{width:{exact:1280},height:{exact:720}},{width:{exact:1920},height:{exact:1080}},{width:{exact:3840},height:{exact:2160}},{width:{exact:4096},height:{exact:2160}},{width:{exact:7680},height:{exact:4320}}],z=Object(s.e)((function(e){var t=e.history,n=Object(x.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution}})),r=n.connections,i=n.audio,o=n.video,a=n.resolution,s=Object(x.b)(),u=Object(c.useRef)(),l=Object(c.useState)(!1),d=Object(h.a)(l,2),j=d[0],b=d[1],g=Object(c.useState)(!1),v=Object(h.a)(g,2),m=v[0],p=v[1];Object(c.useEffect)((function(){y(a)}),[]);var y=function(){var e=Object(O.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u.current.srcObject&&(console.log("stop track"),u.current.srcObject.getTracks().forEach((function(e){e.stop()}))),e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:t}).then((function(e){u.current.srcObject=e;var t=e.getVideoTracks()[0].getSettings(),n=document.getElementById("await-video-container");n.style.width="".concat(t.width,"px"),n.style.height="".concat(t.height,"px")}));case 4:b(!0),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("getUserMedia error",e.t0),b(!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsx)(N,{audio:i,video:o,toggleAudio:function(){u.current.srcObject.getAudioTracks()[0].enabled=!i,s(U({connections:r,video:o,audio:!i,resolution:a}))},toggleVideo:function(){u.current.srcObject.getVideoTracks()[0].enabled=!o,s(U({connections:r,audio:i,video:!o,resolution:a}))},initCall:function(){u.current.srcObject&&(console.log("stop track"),u.current.srcObject.getTracks().forEach((function(e){e.stop()})),u.current=null),t.push("./test")},connections:r,setConnections:function(e){return s(U({connections:e,audio:i,video:o,resolution:a}))},setResolution:function(e){s(U({connections:r,audio:!0,video:!0,resolution:H[e]})),y(H[e])},localStream:u,foundLocal:j,history:t,isOpen:m,setIsOpen:p})})),G=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(I.jsx)(z,{})}}]),n}(r.a.Component),J=n(102),K=n.n(J),W=n(224),_=n(225),Q=n(226);n(233),n(230),n(223),n(218),n(219),n(220),n(222),n(221);var X=function(e){var t=e.audio,n=e.video,c=e.setConnections,i=e.toggleAudio,o=e.toggleVideo,a=e.toggleView,s=e.hangup,u=e.connections,l=e.localStreamRef,d=(e.statsIsOpen,e.openStats),j=(e.closeStats,e.statMessages,e.isSender,e.setIsSender,M());return Object(I.jsxs)(r.a.Fragment,{children:[Object(I.jsxs)("div",{id:"my-area",children:[Object(I.jsx)(W.a,{}),Object(I.jsxs)("p",{children:[" ",u]}),Object(I.jsx)(g.a,{onClick:function(){return c(u+1)},children:"+"}),Object(I.jsx)(g.a,{onClick:function(){return c(u-1)},children:"-"}),Object(I.jsx)("video",{id:"my-video",ref:l,autoPlay:!0})]}),Object(I.jsx)("main",{children:Object(I.jsxs)("div",{id:"call-main",children:[Object(I.jsx)("div",{id:"call-videos",children:Array.from({length:u},(function(e,t){return Object(I.jsx)("div",{className:"remote-container",id:"remote-container ".concat(t),children:Object(I.jsx)("video",{className:"remote-video",id:"remote-video ".concat(t),onClick:function(){return d(t)},autoPlay:!0})},t)}))}),Object(I.jsxs)(v.a,{container:!0,justify:"space-between",alignItems:"center",children:[Object(I.jsx)(v.a,{item:!0}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsxs)(v.a,{container:!0,spacing:2,children:[Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:i,children:t?Object(I.jsx)(m.a,{}):Object(I.jsx)(p.a,{})})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:o,children:n?Object(I.jsx)(y.a,{}):Object(I.jsx)(k.a,{})})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:s,children:Object(I.jsx)(_.a,{})})})]})}),Object(I.jsx)(v.a,{item:!0,children:Object(I.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:a,children:Object(I.jsx)(Q.a,{})})})]})]})})]})},Y=Object(s.e)((function(e){var t=e.history,n=Object(x.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution}})),r=n.connections,i=n.audio,o=n.video,a=n.resolution,s=Object(c.useState)(!1),u=Object(h.a)(s,2),l=u[0],d=u[1],j=Object(x.b)(),b=Object(c.useRef)(),g=Object(c.useRef)(Array.from({length:100},(function(){return null}))),v=Object(c.useState)(null),m=Object(h.a)(v,2),p=m[0],y=m[1],k=Object(c.useRef)(Array.from({length:100},(function(){return null}))),w=Object(c.useState)(0),C=Object(h.a)(w,2),S=C[0],T=C[1],R=Object(c.useState)(0),D=Object(h.a)(R,2),E=D[0],B=D[1],M=Object(c.useState)("sidebar"),N=Object(h.a)(M,2),A=N[0],V=N[1],L=Object(c.useState)(!1),P=Object(h.a)(L,2),F=P[0],q=P[1],H=Object(c.useState)([[],[]]),z=Object(h.a)(H,2),G=z[0],J=z[1],W=Object(c.useState)(null),_=Object(h.a)(W,2),Q=_[0],Y=_[1],Z=Object(c.useState)("sender"),$=Object(h.a)(Z,2),ee=$[0],te=$[1];Object(c.useEffect)((function(){return ne(),window.addEventListener("resize",ne),re(),function(){window.removeEventListener("resize",ne),j(U({connections:r,audio:!0,video:!0,resolution:a}))}}),[]),Object(c.useEffect)((function(){ce()}),[r]),Object(c.useEffect)((function(){p&&ie(1)}),[p]),Object(c.useEffect)((function(){ce()}),[A,E,S]);var ne=function(){var e=document.getElementById("call-videos");T(e.offsetWidth),B(e.offsetHeight)},ce=function(){for(var e,t,n=0;n<r;n++)e=document.getElementById("remote-video ".concat(n)),t=document.getElementById("remote-container ".concat(n)),S>E?(e.style.width="100%",e.style.height="auto"):(e.style.width="auto",e.style.height="100%"),"sidebar"===A?(t.style.display="block",t.style.position="absolute",0===n?(t.style.left=0,t.style.width="".concat(S-220,"px"),t.style.height="100%"):n>5?t.style.display="none":(t.style.right=0,t.style.width="218px",t.style.height="123px",t.style.top="".concat(123*Math.min(n-1,6)+64,"px"))):(t.style.display="block",t.style.top="auto",t.style.left="auto",t.style.right="auto",n>49&&(t.style.display="none"),t.style.position="relative",t.style.width="".concat(S/Math.ceil(Math.sqrt(Math.min(r,49))),"px"),t.style.height="".concat(E/Math.ceil(Math.sqrt(Math.min(r,49))),"px"))},re=function(){var e=Object(O.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:i||!0,video:!o||a}).then((function(e){b.current.srcObject=e}));case 3:b.current.srcObject.getAudioTracks()[0].enabled=i,b.current.srcObject.getVideoTracks()[0].enabled=o,y(K()("https://rtc-test-app.herokuapp.com/")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("getUserMedia error",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ie=function(e){try{p.emit("enterRoom",e),p.on("joined",(function(){for(var e=0;e<r;e++)d(!0),oe(e);p.on("signal-to-caller",(function(e){console.log("signal-to-caller",e),"answer"===e.signalData.type?g.current[e.idx].setRemoteDescription(e.signalData):"candidate"===e.signalData.type&&g.current[e.idx].addIceCandidate(e.signalData)}))})),p.on("offer-to-callee",(function(e){console.log("received offer",e),ae(e.signalData,e.idx),p.on("candidate-to-callee",(function(e){console.log("callee received candidate",e),g.current[e.idx].addIceCandidate(e.signalData)}))})),p.on("close",(function(e){return fe(e)})),p.on("end",(function(){Oe(!1)})),p.once("joinResult",(function(e){console.log("joinResult",e)}))}catch(t){console.log("room enter error",t)}},oe=function(){var e=Object(O.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.current[t]=new RTCPeerConnection(null),g.current[t].onicecandidate=function(e){return je(e,t)},b.current&&b.current.srcObject&&b.current.srcObject.getTracks().forEach((function(e){return g.current[t].addTrack(e,b.current.srcObject)})),g.current[t].createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then((function(e){return ue(e,t)}),se),g.current[t].ontrack=function(e){return de(e,t)};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=Object(O.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.current[n]=new RTCPeerConnection(null),g.current[n].ontrack=function(e){return de(e,n)},g.current[n].onicecandidate=function(e){return be(e,n)},b.current&&b.current.srcObject&&b.current.srcObject.getTracks().forEach((function(e){return g.current[n].addTrack(e,b.current.srcObject)})),g.current[n].setRemoteDescription(t),g.current[n].createAnswer().then((function(e){return le(e,n)}),se);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function se(e){console.log("Failed to create session description: ".concat(e.toString()))}function ue(e,t){g.current[t].setLocalDescription(e),p.emit("caller-to-server",{room:1,signalData:e,idx:t}),console.log("Offer from pc".concat(t,"Local\n").concat(e.sdp))}function le(e,t){g.current[t].setLocalDescription(e),p.emit("callee-to-server",{room:1,signalData:e,idx:t})}function de(e,t){if(k.current[t]!==e.streams[0]){k.current[t]=e.streams[0];var n=document.getElementById("remote-video ".concat(t));n&&(n.srcObject=k.current[t]),console.log("pc".concat(t,": received remote stream"))}else console.log("test failed!")}function je(e,t){p.emit("caller-to-server",{room:1,signalData:e.candidate,idx:t})}function be(e,t){p.emit("callee-to-server",{room:1,signalData:e.candidate,idx:t})}var fe=function(e){g.current[e]&&(g.current[e].close(),g.current[e]=null),l&&p.emit("close",1,e)},Oe=function(e){for(var n=0;n<r;n++)fe(n);e&&(b.current&&b.current.srcObject&&(b.current.srcObject.getTracks().forEach((function(e){e.stop()})),b.current=null,y(null)),p&&(p.emit("leaveRoom",1),p.disconnect()),t.push("/"))};return Object(I.jsx)(X,{audio:i,video:o,setConnections:function(e){return function(e){if(e>r)for(var t=r;t<e;t++)oe(t);else for(var n=e;n<r;n++)fe(n);j(U({connections:e,audio:i,video:o,resolution:a}))}(e)},toggleAudio:function(){b.current.srcObject&&(b.current.srcObject.getAudioTracks()[0].enabled=!i,j(U({connections:r,video:o,audio:!i,resolution:a})))},toggleVideo:function(){b.current.srcObject&&(b.current.srcObject.getVideoTracks()[0].enabled=!o,j(U({connections:r,audio:i,video:!o,resolution:a})))},toggleView:function(){V("sidebar"===A?"tiles":"sidebar")},hangup:function(){return Oe(!0)},connections:r,localStreamRef:b,remoteStreamRefs:k,statsIsOpen:F,openStats:function(e){return function(e){Q&&clearInterval(Q);var t=setInterval(Object(O.a)(f.a.mark((function t(){var n,c,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=["",""],!g.current[e]||!g.current[e].pcLocal){t.next=6;break}return t.next=4,g.current[e].pcLocal.getStats(null).then((function(e){return e}),(function(e){return e.toString()}));case 4:c=t.sent,n[0]=c;case 6:if(!g.current[e]||!g.current[e].pcRemote){t.next=11;break}return t.next=9,g.current[e].pcRemote.getStats(null).then((function(e){return e}),(function(e){return e.toString()}));case 9:r=t.sent,n[1]=r;case 11:J(n);case 12:case"end":return t.stop()}}),t)}))),1e3);Y(t),q(!0)}(e)},closeStats:function(){clearInterval(Q),q(!1),Y(null)},statMessages:G,isSender:ee,setIsSender:te})})),Z=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(I.jsx)(Y,{})}}]),n}(r.a.Component);n(163);var $=function(){return Object(I.jsxs)(a.a,{basename:"/rtc-test-app",hashType:"noslash",children:[Object(I.jsx)(s.a,{exact:!0,path:"/",component:G}),Object(I.jsx)(s.a,{exact:!0,path:"/test",component:Z})]})},ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,236)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),c(e),r(e),i(e),o(e)}))},te=n(39),ne=Object(te.combineReducers)({rtc:q}),ce=function(e,t){return ne(e,t)},re=n(103),ie=Object(te.createStore)(ce,Object(re.composeWithDevTools)());o.a.render(Object(I.jsx)(x.a,{store:ie,children:Object(I.jsx)(r.a.StrictMode,{children:Object(I.jsx)($,{})})}),document.getElementById("root")),ee()}},[[164,1,2]]]);
//# sourceMappingURL=main.5ac4a04f.chunk.js.map