(this["webpackJsonprtc-test"]=this["webpackJsonprtc-test"]||[]).push([[0],{126:function(e,t,n){},164:function(e,t,n){},165:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),o=n(11),i=n.n(o),a=(n(126),n(60)),s=n(13),u=n(61),l=n(62),d=n(72),j=n(71),b=n(21),f=n.n(b),h=n(45),O=n(23),m=n(36),g=n(212),v=n(213),x=n(227),p=n(214),y=n(215),k=n(216),w=n(217),C=n(232),S=n(211),T=n(209),R=n(210),E=n(2);function I(e){var t=e.open,n=e.message,c=e.label,r=e.setText,o=e.value,i=e.submit;return Object(E.jsxs)(C.a,{open:t,children:[Object(E.jsxs)(T.a,{children:[Object(E.jsx)(R.a,{children:n}),Object(E.jsx)(x.a,{label:c,type:"number",onChange:function(e){var t=Number(e.target.value);t>100&&(t=100),t<1&&(t=1),r(t)},inputProps:{min:1,max:100},value:o})]}),Object(E.jsx)(S.a,{children:Object(E.jsx)(g.a,{onClick:i,color:"primary",children:"\uc785\ub825"})})]})}var D=n(104),B=n(228),M=(Object(D.a)({overrides:{MuiGrid:{container:{height:"100%"}}},palette:{primary:{main:"#38BF87"},secondary:{main:"#ff1a1a"}}}),Object(B.a)((function(){return{roundButton:{borderRadius:"50%",width:"60px",height:"60px"}}}))),A=function(e){var t=e.connections,n=e.setConnections,c=e.setResolution,o=e.setRoom,i=e.audio,a=e.video,s=e.room,u=e.toggleAudio,l=e.toggleVideo,d=e.initCall,j=e.localStream,b=e.isOpen,f=e.setIsOpen,h=M();return Object(E.jsxs)(r.a.Fragment,{children:[Object(E.jsx)("main",{children:Object(E.jsxs)(v.a,{container:!0,id:"await-main",spacing:10,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)("div",{id:"await-video-container",children:[Object(E.jsx)("video",{id:"await-video",ref:j,autoPlay:!0}),Object(E.jsxs)("div",{id:"await-video-controls",children:[Object(E.jsx)(g.a,{variant:"contained",className:h.roundButton,onClick:u,children:i?Object(E.jsx)(p.a,{}):Object(E.jsx)(y.a,{})}),Object(E.jsx)(g.a,{variant:"contained",className:h.roundButton,onClick:l,children:a?Object(E.jsx)(k.a,{}):Object(E.jsx)(w.a,{})})]})]})}),Object(E.jsx)(v.a,{item:!0,className:h.awaitControls,children:Object(E.jsxs)(v.a,{container:!0,direction:"column",spacing:1,alignItems:"center",children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)("div",{id:"await-resoultion-controls",children:[Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(0)},children:"qvga"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(1)},children:"vga"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(2)},children:"HD"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(3)},children:"fullHD"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(4)},children:"TV4k"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(5)},children:"cinema4K"}),Object(E.jsx)(g.a,{variant:"contained",onClick:function(){return c(5)},children:"8K"})]})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)(g.a,{onClick:function(){return f(!0)},children:["Connections: ",t]})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{label:"\ucc44\ud305\ubc29 id",value:s,onChange:function(e){return o(e.target.value)}})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)(v.a,{container:!0,spacing:1,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{disabled:!s,variant:"contained",onClick:function(){return f(!0)},children:"\uc2e0\uaddc \ubc29 \uc0dd\uc131"})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{disabled:!s,variant:"contained",onClick:function(){return d(!1)},children:"\uae30\uc874 \ubc29 \uc785\uc7a5"})})]})})]})})]})}),Object(E.jsx)(I,{open:b,message:"Peer \uc218 \uc785\ub825",label:"peer",setText:n,value:t,submit:function(){f(!1),d(!0)}})]})},V=n(68),N=n(80),P=n(234),F=n(229),L="rtc/SET_SETTINGS",H=Object(P.a)(L,(function(e){return e})),U=Object(F.a)(Object(V.a)({},L,(function(e,t){var n=t.payload;return Object(N.a)(Object(N.a)({},e),{},{setting:n})})),{setting:{connections:1,audio:!0,video:!0,resolution:{width:{exact:320},height:{exact:240}},room:""}}),q=[{width:{exact:320},height:{exact:240}},{width:{exact:640},height:{exact:480}},{width:{exact:1280},height:{exact:720}},{width:{exact:1920},height:{exact:1080}},{width:{exact:3840},height:{exact:2160}},{width:{exact:4096},height:{exact:2160}},{width:{exact:7680},height:{exact:4320}}],z=Object(s.e)((function(e){var t=e.history,n=Object(m.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution,room:t.setting.room}})),r=n.connections,o=n.audio,i=n.video,a=n.resolution,s=n.room,u=Object(m.b)(),l=Object(c.useRef)(),d=Object(c.useState)(!1),j=Object(O.a)(d,2),b=j[0],g=j[1];Object(c.useEffect)((function(){v(a)}),[]);var v=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.current.srcObject&&(console.log("stop track"),l.current.srcObject.getTracks().forEach((function(e){e.stop()}))),e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:t}).then((function(e){l.current.srcObject=e;var t=e.getVideoTracks()[0].getSettings(),n=document.getElementById("await-video-container");n.style.width="".concat(t.width,"px"),n.style.height="".concat(t.height,"px")}));case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("getUserMedia error",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsx)(A,{audio:o,video:i,room:s,toggleAudio:function(){l.current.srcObject.getAudioTracks()[0].enabled=!o,u(H({connections:r,video:i,audio:!o,resolution:a,room:s}))},toggleVideo:function(){l.current.srcObject.getVideoTracks()[0].enabled=!i,u(H({connections:r,audio:o,video:!i,resolution:a,room:s}))},initCall:function(e){l.current.srcObject&&(console.log("stop track"),l.current.srcObject.getTracks().forEach((function(e){e.stop()})),u(H({connections:r,video:i,audio:o,resolution:a,room:s})),l.current=null),t.push("./test",{isHost:e})},connections:r,setConnections:function(e){return u(H({connections:e,audio:o,video:i,resolution:a,room:s}))},setResolution:function(e){u(H({connections:r,audio:!0,video:!0,resolution:q[e],room:s})),v(q[e])},setRoom:function(e){return u(H({connections:r,audio:o,video:i,resolution:a,room:e}))},localStream:l,history:t,isOpen:b,setIsOpen:g})})),G=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(E.jsx)(z,{})}}]),n}(r.a.Component),J=n(102),K=n.n(J),W=n(224),_=n(225),Q=n(226);n(233),n(230),n(223),n(218),n(219),n(220),n(222),n(221);var X=function(e){var t=e.audio,n=e.video,c=e.setConnections,o=e.toggleAudio,i=e.toggleVideo,a=e.toggleView,s=e.hangup,u=e.connections,l=e.localStreamRef,d=(e.statsIsOpen,e.openStats),j=(e.closeStats,e.statMessages,e.isSender,e.setIsSender,M());return Object(E.jsxs)(r.a.Fragment,{children:[Object(E.jsxs)("div",{id:"my-area",children:[Object(E.jsx)(W.a,{}),Object(E.jsxs)("p",{children:[" ",u]}),Object(E.jsx)(g.a,{onClick:function(){return c(u+1)},children:"+"}),Object(E.jsx)(g.a,{onClick:function(){return c(u-1)},children:"-"}),Object(E.jsx)("video",{id:"my-video",ref:l,autoPlay:!0})]}),Object(E.jsx)("main",{children:Object(E.jsxs)("div",{id:"call-main",children:[Object(E.jsx)("div",{id:"call-videos",children:Array.from({length:u},(function(e,t){return Object(E.jsx)("div",{className:"remote-container",id:"remote-container ".concat(t),children:Object(E.jsx)("video",{className:"remote-video",id:"remote-video ".concat(t),onClick:function(){return d(t)},autoPlay:!0})},t)}))}),Object(E.jsxs)(v.a,{container:!0,justify:"space-between",alignItems:"center",children:[Object(E.jsx)(v.a,{item:!0}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)(v.a,{container:!0,spacing:2,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:o,children:t?Object(E.jsx)(p.a,{}):Object(E.jsx)(y.a,{})})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:i,children:n?Object(E.jsx)(k.a,{}):Object(E.jsx)(w.a,{})})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:s,children:Object(E.jsx)(_.a,{})})})]})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{variant:"contained",className:j.roundButton,onClick:a,children:Object(E.jsx)(Q.a,{})})})]})]})})]})},Y=Object(s.e)((function(e){var t=e.history,n=Object(m.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution,room:t.setting.room}})),r=n.connections,o=n.audio,i=n.video,a=n.resolution,s=n.room,u=t.location.state&&t.location.state.isHost,l=Object(m.b)(),d=Object(c.useRef)(),j=Object(c.useRef)(Array.from({length:100},(function(){return null}))),b=Object(c.useState)(null),g=Object(O.a)(b,2),v=g[0],x=g[1],p=Object(c.useRef)(Array.from({length:100},(function(){return null}))),y=Object(c.useState)(0),k=Object(O.a)(y,2),w=k[0],C=k[1],S=Object(c.useState)(0),T=Object(O.a)(S,2),R=T[0],I=T[1],D=Object(c.useState)("sidebar"),B=Object(O.a)(D,2),M=B[0],A=B[1],V=Object(c.useState)(!1),N=Object(O.a)(V,2),P=N[0],F=N[1],L=Object(c.useState)([[],[]]),U=Object(O.a)(L,2),q=U[0],z=U[1],G=Object(c.useState)(null),J=Object(O.a)(G,2),W=J[0],_=J[1],Q=Object(c.useState)("sender"),Y=Object(O.a)(Q,2),Z=Y[0],$=Y[1];Object(c.useEffect)((function(){return ee(),window.addEventListener("resize",ee),ne(),x(K()("https://rtc-test-app.herokuapp.com/")),function(){window.removeEventListener("resize",ee)}}),[]),Object(c.useEffect)((function(){te()}),[r]),Object(c.useEffect)((function(){v&&ce(s)}),[v]),Object(c.useEffect)((function(){te()}),[M,R,w]);var ee=function(){var e=document.getElementById("call-videos");C(e.offsetWidth),I(e.offsetHeight)},te=function(){for(var e,t,n=0;n<r;n++)e=document.getElementById("remote-video ".concat(n)),t=document.getElementById("remote-container ".concat(n)),w>R?(e.style.width="100%",e.style.height="auto"):(e.style.width="auto",e.style.height="100%"),"sidebar"===M?(t.style.display="block",t.style.position="absolute",0===n?(t.style.left=0,t.style.width="".concat(w-220,"px"),t.style.height="100%"):n>5?t.style.display="none":(t.style.right=0,t.style.width="218px",t.style.height="123px",t.style.top="".concat(123*Math.min(n-1,6)+64,"px"))):(t.style.display="block",t.style.top="auto",t.style.left="auto",t.style.right="auto",n>49&&(t.style.display="none"),t.style.position="relative",t.style.width="".concat(w/Math.ceil(Math.sqrt(Math.min(r,49))),"px"),t.style.height="".concat(R/Math.ceil(Math.sqrt(Math.min(r,49))),"px"))},ne=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:o||!0,video:!i||a}).then((function(e){d.current.srcObject=e}));case 3:d.current.srcObject.getAudioTracks()[0].enabled=o,d.current.srcObject.getVideoTracks()[0].enabled=i,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("getUserMedia error",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ce=function(e){try{v.emit("enterRoom",e,u),v.on("joined",(function(){v.emit("connections-adjusted",e,r);for(var t=0;t<r;t++)re(t);v.on("signal-to-caller",(function(e){"answer"===e.signalData.type?(j.current[e.idx].setRemoteDescription(e.signalData),console.log("caller received answer",e)):e.signalData.candidate&&(j.current[e.idx].addIceCandidate(e.signalData),console.log("caller received candidate",e))}))})),v.on("offer-to-callee",(function(e){console.log("callee received offer",e),oe(e.signalData,e.idx)})),v.on("adjust-connections",(function(t){return l(H({connections:t,audio:o,video:i,resolution:a,room:e}))})),v.on("candidate-to-callee",(function(e){console.log("callee received candidate",e),j.current[e.idx].addIceCandidate(e.signalData)})),v.on("close",(function(e){return je(e)})),v.on("end",(function(){be(!1)})),v.once("joinResult",(function(e,n){e||(alert(n),d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach((function(e){e.stop()})),d.current=null),v.disconnect(),l(H({connections:r,audio:!0,video:!0,resolution:a,room:""})),t.push("/"))}))}catch(n){console.log("room enter error",n)}},re=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.current[t]=new RTCPeerConnection({config:{iceServers:[{urls:["turn:10.186.117.86:3478?transport=udp"],credential:"1234",username:"test"}]}}),j.current[t].onicecandidate=function(e){return le(e,t)},d.current&&d.current.srcObject&&d.current.srcObject.getTracks().forEach((function(e){return j.current[t].addTrack(e,d.current.srcObject)})),j.current[t].createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then((function(e){return ae(e,t)}),ie),j.current[t].ontrack=function(e){return ue(e,t)};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.current[n]=new RTCPeerConnection({config:{iceServers:[{urls:["turn:10.186.117.86:3478?transport=udp"],credential:"1234",username:"test"}]}}),j.current[n].onicecandidate=function(e){return de(e,n)},d.current&&d.current.srcObject&&d.current.srcObject.getTracks().forEach((function(e){return j.current[n].addTrack(e,d.current.srcObject)})),j.current[n].setRemoteDescription(t),j.current[n].createAnswer().then((function(e){return se(e,n)}),ie),j.current[n].ontrack=function(e){return ue(e,n)};case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function ie(e){console.log("Failed to create session description: ".concat(e.toString()))}function ae(e,t){j.current[t].setLocalDescription(e),v.emit("caller-to-server",{room:s,signalData:e,idx:t,connections:r}),console.log("create offer",e)}function se(e,t){console.log("create answer"),j.current[t].setLocalDescription(e),v.emit("callee-to-server",{room:s,signalData:e,idx:t})}function ue(e,t){if(p.current[t]!==e.streams[0]){p.current[t]=e.streams[0];var n=document.getElementById("remote-video ".concat(t));n?(n.srcObject=p.current[t],console.log("pc".concat(t,": set remote stream as srcObject"))):console.log("pc".concat(t,": set fail remote stream"),n)}else console.log("pc".concat(t,": failed to receive remote stream"))}function le(e,t){v.emit("caller-to-server",{room:s,signalData:e.candidate,idx:t})}function de(e,t){v.emit("callee-to-server",{room:s,signalData:e.candidate,idx:t})}var je=function(e){j.current[e]&&(j.current[e].close(),j.current[e]=null),u&&v.emit("close",s,e)},be=function(e){for(var n=0;n<r;n++)je(n);e&&(d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach((function(e){e.stop()})),d.current=null),v&&(console.log("should disconnect socket"),v.emit("leaveRoom",s)),l(H({connections:r,audio:!0,video:!0,resolution:a,room:""})),t.push("/"))};return Object(E.jsx)(X,{audio:o,video:i,setConnections:function(e){return function(e){if(v.emit("connections-adjusted",s,e),e>r)for(var t=r;t<e;t++)re(t);else for(var n=e;n<r;n++)je(n);l(H({connections:e,audio:o,video:i,resolution:a,room:s}))}(e)},toggleAudio:function(){d.current.srcObject&&(d.current.srcObject.getAudioTracks()[0].enabled=!o,l(H({connections:r,video:i,audio:!o,resolution:a,room:s})))},toggleVideo:function(){d.current.srcObject&&(d.current.srcObject.getVideoTracks()[0].enabled=!i,l(H({connections:r,audio:o,video:!i,resolution:a,room:s})))},toggleView:function(){A("sidebar"===M?"tiles":"sidebar")},hangup:function(){return be(!0)},connections:r,localStreamRef:d,remoteStreamRefs:p,statsIsOpen:P,openStats:function(e){return function(e){W&&clearInterval(W);var t=setInterval(Object(h.a)(f.a.mark((function t(){var n,c,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=["",""],!j.current[e]||!j.current[e].pcLocal){t.next=6;break}return t.next=4,j.current[e].pcLocal.getStats(null).then((function(e){return e}),(function(e){return e.toString()}));case 4:c=t.sent,n[0]=c;case 6:if(!j.current[e]||!j.current[e].pcRemote){t.next=11;break}return t.next=9,j.current[e].pcRemote.getStats(null).then((function(e){return e}),(function(e){return e.toString()}));case 9:r=t.sent,n[1]=r;case 11:z(n);case 12:case"end":return t.stop()}}),t)}))),1e3);_(t),F(!0)}(e)},closeStats:function(){clearInterval(W),F(!1),_(null)},statMessages:q,isSender:Z,setIsSender:$})})),Z=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(E.jsx)(Y,{})}}]),n}(r.a.Component);n(164);var $=function(){return Object(E.jsxs)(a.a,{basename:"/rtc-test-app",hashType:"noslash",children:[Object(E.jsx)(s.a,{exact:!0,path:"/",component:G}),Object(E.jsx)(s.a,{exact:!0,path:"/test",component:Z})]})},ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,236)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),o(e),i(e)}))},te=n(39),ne=Object(te.combineReducers)({rtc:U}),ce=function(e,t){return ne(e,t)},re=n(103),oe=Object(te.createStore)(ce,Object(re.composeWithDevTools)());i.a.render(Object(E.jsx)(m.a,{store:oe,children:Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsx)($,{})})}),document.getElementById("root")),ee()}},[[165,1,2]]]);
//# sourceMappingURL=main.457f06f8.chunk.js.map