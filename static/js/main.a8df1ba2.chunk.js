(this["webpackJsonprtc-test"]=this["webpackJsonprtc-test"]||[]).push([[0],{118:function(e,t,n){},156:function(e,t,n){},157:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),o=n(10),i=n.n(o),a=(n(118),n(57)),s=n(12),u=n(58),l=n(59),d=n(68),j=n(67),b=n(18),f=n.n(b),h=n(42),O=n(26),m=n(35),x=n(216),v=n(200),g=n(213),p=n(201),y=n(202),k=n(203),w=n(204),C=n(218),S=n(199),T=n(198),D=n(220),E=n(2);function R(e){var t=e.open,n=e.message,c=e.label,r=e.setText,o=e.value,i=e.cancel,a=e.submit;return Object(E.jsxs)(C.a,{open:t,children:[Object(E.jsxs)(T.a,{children:[Object(E.jsx)(D.a,{children:n}),Object(E.jsx)(g.a,{label:c,type:"number",onChange:function(e){var t=Number(e.target.value);t>100&&(t=100),t<1&&(t=1),r(t)},inputProps:{min:1,max:100},value:o})]}),Object(E.jsxs)(S.a,{children:[Object(E.jsx)(x.a,{onClick:i,color:"primary",children:"\ucde8\uc18c"}),Object(E.jsx)(x.a,{onClick:a,color:"primary",children:"\uc785\ub825"})]})]})}var I=n(100),B=n(214),M=(Object(I.a)({overrides:{MuiGrid:{container:{height:"100%"}}},palette:{primary:{main:"#38BF87"},secondary:{main:"#ff1a1a"}}}),Object(B.a)((function(){return{roundButton:{borderRadius:"50%",width:"60px",height:"60px"}}}))),A=function(e){var t=e.connections,n=e.setConnections,c=e.setResolution,o=e.setRoom,i=e.audio,a=e.video,s=e.room,u=e.toggleAudio,l=e.toggleVideo,d=e.initCall,j=e.localStream,b=e.isOpen,f=e.setIsOpen,h=M();return Object(E.jsxs)(r.a.Fragment,{children:[Object(E.jsx)("main",{children:Object(E.jsxs)(v.a,{container:!0,id:"await-main",spacing:10,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)("div",{id:"await-video-container",children:[Object(E.jsx)("video",{id:"await-video",ref:j,autoPlay:!0}),Object(E.jsxs)("div",{id:"await-video-controls",children:[Object(E.jsx)(x.a,{variant:"contained",className:h.roundButton,onClick:u,children:i?Object(E.jsx)(p.a,{}):Object(E.jsx)(y.a,{})}),Object(E.jsx)(x.a,{variant:"contained",className:h.roundButton,onClick:l,children:a?Object(E.jsx)(k.a,{}):Object(E.jsx)(w.a,{})})]})]})}),Object(E.jsx)(v.a,{item:!0,className:h.awaitControls,children:Object(E.jsxs)(v.a,{container:!0,direction:"column",spacing:1,alignItems:"center",children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)("div",{id:"await-resoultion-controls",children:[Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(0)},children:"qvga"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(1)},children:"vga"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(2)},children:"HD"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(3)},children:"fullHD"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(4)},children:"TV4k"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(5)},children:"cinema4K"}),Object(E.jsx)(x.a,{variant:"contained",onClick:function(){return c(5)},children:"8K"})]})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(g.a,{label:"\ucc44\ud305\ubc29 id",value:s,onChange:function(e){return o(e.target.value)}})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)(v.a,{container:!0,spacing:1,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{disabled:!s,variant:"contained",onClick:function(){return f(!0)},children:"\uc2e0\uaddc \ubc29 \uc0dd\uc131"})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{disabled:!s,variant:"contained",onClick:function(){return d(!1)},children:"\uae30\uc874 \ubc29 \uc785\uc7a5"})})]})})]})})]})}),Object(E.jsx)(R,{open:b,message:"Peer \uc218 \uc785\ub825",label:"peer",setText:n,value:t,cancel:function(){return f(!1)},submit:function(){f(!1),d(!0)}})]})},V=n(65),N=n(76),H=n(219),P=n(215),F="rtc/SET_SETTINGS",L=Object(H.a)(F,(function(e){return e})),U=Object(P.a)(Object(V.a)({},F,(function(e,t){var n=t.payload;return Object(N.a)(Object(N.a)({},e),{},{setting:n})})),{setting:{connections:1,audio:!0,video:!0,resolution:{width:{exact:320},height:{exact:240}},room:""}}),W=[{width:{exact:320},height:{exact:240}},{width:{exact:640},height:{exact:480}},{width:{exact:1280},height:{exact:720}},{width:{exact:1920},height:{exact:1080}},{width:{exact:3840},height:{exact:2160}},{width:{exact:4096},height:{exact:2160}},{width:{exact:7680},height:{exact:4320}}],q=Object(s.e)((function(e){var t=e.history,n=Object(m.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution,room:t.setting.room}})),r=n.connections,o=n.audio,i=n.video,a=n.resolution,s=n.room,u=Object(m.b)(),l=Object(c.useRef)(),d=Object(c.useState)(!1),j=Object(O.a)(d,2),b=j[0],x=j[1];Object(c.useEffect)((function(){v(a)}),[]);var v=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.current.srcObject&&(console.log("stop track"),l.current.srcObject.getTracks().forEach((function(e){e.stop()}))),e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:t}).then((function(e){l.current.srcObject=e;var t=e.getVideoTracks()[0].getSettings(),n=document.getElementById("await-video-container");n.style.width="".concat(t.width,"px"),n.style.height="".concat(t.height,"px")}));case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("getUserMedia error",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsx)(A,{audio:o,video:i,room:s,toggleAudio:function(){l.current.srcObject.getAudioTracks()[0].enabled=!o,u(L({connections:r,video:i,audio:!o,resolution:a,room:s}))},toggleVideo:function(){l.current.srcObject.getVideoTracks()[0].enabled=!i,u(L({connections:r,audio:o,video:!i,resolution:a,room:s}))},initCall:function(e){l.current.srcObject&&(console.log("stop track"),l.current.srcObject.getTracks().forEach((function(e){e.stop()})),u(L({connections:r,video:i,audio:o,resolution:a,room:s})),l.current=null),t.push("./test",{isHost:e})},connections:r,setConnections:function(e){return u(L({connections:e,audio:o,video:i,resolution:a,room:s}))},setResolution:function(e){u(L({connections:r,audio:!0,video:!0,resolution:W[e],room:s})),v(W[e])},setRoom:function(e){return u(L({connections:r,audio:o,video:i,resolution:a,room:e}))},localStream:l,history:t,isOpen:b,setIsOpen:x})})),z=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(E.jsx)(q,{})}}]),n}(r.a.Component),G=n(98),J=n.n(G),K=n(210),_=n(211),Q=n(212),X=n(205),Y=n(206),Z=n(207),$=n(209),ee=n(208),te=function(e){var t=e.tableHead,n=e.tableData;return Object(E.jsxs)(X.a,{children:[Object(E.jsx)(Y.a,{children:Object(E.jsx)(Z.a,{children:t.map((function(e){return Object(E.jsx)(ee.a,{children:e})}))})}),Object(E.jsx)($.a,{children:n.map((function(e){return Object(E.jsx)(Z.a,{children:e.map((function(e){return Object(E.jsx)(ee.a,{children:e})}))})}))})]})};function ne(e){var t=e.open,n=e.messages,c=e.confirm,r={},o=[];return n.forEach((function(e){var t,n=[];for(t in o.push(e.id),e)n.push([t,e[t]]);r[e.id]=n})),Object(E.jsxs)(C.a,{open:t,fullWidth:!0,maxWidth:"xl",children:[Object(E.jsx)(T.a,{children:o.map((function(e){return Object(E.jsxs)("details",{children:[Object(E.jsx)("summary",{children:e}),Object(E.jsx)(te,{tableHead:["parameter","value"],tableData:r[e]})]})}))}),Object(E.jsx)(S.a,{children:Object(E.jsx)(x.a,{onClick:c,color:"primary",children:"\ud655\uc778"})})]})}var ce=function(e){var t=e.audio,n=e.video,c=e.isHost,o=e.setConnections,i=e.toggleAudio,a=e.toggleVideo,s=e.toggleView,u=e.hangup,l=e.connections,d=e.localStreamRef,j=e.statsIsOpen,b=e.openStats,f=e.closeStats,h=e.statMessages,O=M();return Object(E.jsxs)(r.a.Fragment,{children:[Object(E.jsxs)("div",{id:"my-area",children:[Object(E.jsx)(K.a,{}),Object(E.jsxs)("p",{children:[" ",l]}),Object(E.jsx)(x.a,{disabled:!c,onClick:function(){return o(l+1)},children:"+"}),Object(E.jsx)(x.a,{disabled:!c,onClick:function(){return o(l-1)},children:"-"}),Object(E.jsx)("video",{id:"my-video",ref:d,autoPlay:!0})]}),Object(E.jsx)("main",{children:Object(E.jsxs)("div",{id:"call-main",children:[Object(E.jsx)("div",{id:"call-videos",children:Array.from({length:l},(function(e,t){return Object(E.jsx)("div",{className:"remote-container",id:"remote-container ".concat(t),children:Object(E.jsx)("video",{className:"remote-video",id:"remote-video ".concat(t),onClick:function(){return b(t)},autoPlay:!0})},t)}))}),Object(E.jsxs)(v.a,{container:!0,justify:"space-between",alignItems:"center",children:[Object(E.jsx)(v.a,{item:!0}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsxs)(v.a,{container:!0,spacing:2,children:[Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{variant:"contained",className:O.roundButton,onClick:i,children:t?Object(E.jsx)(p.a,{}):Object(E.jsx)(y.a,{})})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{variant:"contained",className:O.roundButton,onClick:a,children:n?Object(E.jsx)(k.a,{}):Object(E.jsx)(w.a,{})})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{variant:"contained",className:O.roundButton,onClick:u,children:Object(E.jsx)(_.a,{})})})]})}),Object(E.jsx)(v.a,{item:!0,children:Object(E.jsx)(x.a,{variant:"contained",className:O.roundButton,onClick:s,children:Object(E.jsx)(Q.a,{})})})]})]})}),Object(E.jsx)(ne,{open:j,messages:h,confirm:f})]})},re=Object(s.e)((function(e){var t=e.history,n=Object(m.c)((function(e){var t=e.rtc;return{connections:t.setting.connections,audio:t.setting.audio,video:t.setting.video,resolution:t.setting.resolution,room:t.setting.room}})),r=n.connections,o=n.audio,i=n.video,a=n.resolution,s=n.room,u=t.location.state&&t.location.state.isHost,l=Object(m.b)(),d=Object(c.useRef)(),j=Object(c.useRef)(Array.from({length:100},(function(){return null}))),b=Object(c.useState)(null),x=Object(O.a)(b,2),v=x[0],g=x[1],p=Object(c.useRef)(Array.from({length:100},(function(){return null}))),y=Object(c.useState)(0),k=Object(O.a)(y,2),w=k[0],C=k[1],S=Object(c.useState)(0),T=Object(O.a)(S,2),D=T[0],R=T[1],I=Object(c.useState)("sidebar"),B=Object(O.a)(I,2),M=B[0],A=B[1],V=Object(c.useState)(!1),N=Object(O.a)(V,2),H=N[0],P=N[1],F=Object(c.useState)([[],[]]),U=Object(O.a)(F,2),W=U[0],q=U[1],z=Object(c.useState)(null),G=Object(O.a)(z,2),K=G[0],_=G[1];Object(c.useEffect)((function(){return Q(),window.addEventListener("resize",Q),Y(),g(J()("https://rtc-test-app.herokuapp.com/")),function(){window.removeEventListener("resize",Q)}}),[]),Object(c.useEffect)((function(){X()}),[r]),Object(c.useEffect)((function(){v&&Z(s)}),[v]),Object(c.useEffect)((function(){X()}),[M,D,w]);var Q=function(){var e=document.getElementById("call-videos");C(e.offsetWidth),R(e.offsetHeight)},X=function(){for(var e,t,n=0;n<r;n++)e=document.getElementById("remote-video ".concat(n)),t=document.getElementById("remote-container ".concat(n)),w>D?(e.style.width="100%",e.style.height="auto"):(e.style.width="auto",e.style.height="100%"),"sidebar"===M?(t.style.display="block",t.style.position="absolute",0===n?(t.style.left=0,t.style.width="".concat(w-220,"px"),t.style.height="100%"):n>5?t.style.display="none":(t.style.right=0,t.style.width="218px",t.style.height="123px",t.style.top="".concat(123*Math.min(n-1,6)+64,"px"))):(t.style.display="block",t.style.top="auto",t.style.left="auto",t.style.right="auto",n>49&&(t.style.display="none"),t.style.position="relative",t.style.width="".concat(w/Math.ceil(Math.sqrt(Math.min(r,49))),"px"),t.style.height="".concat(D/Math.ceil(Math.sqrt(Math.min(r,49))),"px"))},Y=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:o||!0,video:!i||a}).then((function(e){d.current.srcObject=e}));case 3:d.current.srcObject.getAudioTracks()[0].enabled=o,d.current.srcObject.getVideoTracks()[0].enabled=i,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("getUserMedia error",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),Z=function(e){try{v.emit("enterRoom",e,u),v.on("joined",(function(){v.emit("connections-adjusted",e,r);for(var t=0;t<r;t++)$(t);v.on("signal-to-caller",(function(e){"answer"===e.signalData.type?(j.current[e.idx].setRemoteDescription(e.signalData),console.log("caller received answer",e)):e.signalData.candidate&&(j.current[e.idx].addIceCandidate(e.signalData),console.log("caller received candidate",e))}))})),v.on("offer-to-callee",(function(e){console.log("callee received offer",e),ee(e.signalData,e.idx)})),v.on("adjust-connections",(function(t){return l(L({connections:t,audio:o,video:i,resolution:a,room:e}))})),v.on("candidate-to-callee",(function(e){console.log("callee received candidate",e),j.current[e.idx].addIceCandidate(e.signalData)})),v.on("close",(function(e){return se(e)})),v.on("end",(function(){ue(!1)})),v.once("joinResult",(function(e,n){e||(alert(n),d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach((function(e){e.stop()})),d.current=null),v.disconnect(),l(L({connections:r,audio:!0,video:!0,resolution:a,room:""})),t.push("/"))}))}catch(n){console.log("room enter error",n)}},$=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.current[t]=new RTCPeerConnection({config:{iceServers:[{urls:["turn:10.186.117.86:3478?transport=udp"],credential:"1234",username:"test"}]}}),j.current[t].onicecandidate=function(e){return ie(e,t)},d.current&&d.current.srcObject&&d.current.srcObject.getTracks().forEach((function(e){return j.current[t].addTrack(e,d.current.srcObject)})),j.current[t].createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then((function(e){return ne(e,t)}),te),j.current[t].ontrack=function(e){return oe(e,t)};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.current[n]=new RTCPeerConnection({config:{iceServers:[{urls:["turn:10.186.117.86:3478?transport=udp"],credential:"1234",username:"test"}]}}),j.current[n].onicecandidate=function(e){return ae(e,n)},d.current&&d.current.srcObject&&d.current.srcObject.getTracks().forEach((function(e){return j.current[n].addTrack(e,d.current.srcObject)})),j.current[n].setRemoteDescription(t),j.current[n].createAnswer().then((function(e){return re(e,n)}),te),j.current[n].ontrack=function(e){return oe(e,n)};case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function te(e){console.log("Failed to create session description: ".concat(e.toString()))}function ne(e,t){j.current[t].setLocalDescription(e),v.emit("caller-to-server",{room:s,signalData:e,idx:t,connections:r}),console.log("create offer",e)}function re(e,t){console.log("create answer"),j.current[t].setLocalDescription(e),v.emit("callee-to-server",{room:s,signalData:e,idx:t})}function oe(e,t){if(p.current[t]!==e.streams[0]){p.current[t]=e.streams[0];var n=document.getElementById("remote-video ".concat(t));n?(n.srcObject=p.current[t],console.log("pc".concat(t,": set remote stream as srcObject"))):console.log("pc".concat(t,": set fail remote stream"),n)}else console.log("pc".concat(t,": failed to receive remote stream"))}function ie(e,t){v.emit("caller-to-server",{room:s,signalData:e.candidate,idx:t})}function ae(e,t){v.emit("callee-to-server",{room:s,signalData:e.candidate,idx:t})}var se=function(e){j.current[e]&&(j.current[e].close(),j.current[e]=null),u&&v.emit("close",s,e)},ue=function(e){for(var n=0;n<r;n++)se(n);e&&(d.current&&d.current.srcObject&&(d.current.srcObject.getTracks().forEach((function(e){e.stop()})),d.current=null),v&&(console.log("should disconnect socket"),v.emit("leaveRoom",s)),l(L({connections:r,audio:!0,video:!0,resolution:a,room:""})),t.push("/"))};return Object(E.jsx)(ce,{audio:o,video:i,isHost:u,setConnections:function(e){return function(e){if(v.emit("connections-adjusted",s,e),e>r)for(var t=r;t<e;t++)$(t);else for(var n=e;n<r;n++)se(n);l(L({connections:e,audio:o,video:i,resolution:a,room:s}))}(e)},toggleAudio:function(){d.current.srcObject&&(d.current.srcObject.getAudioTracks()[0].enabled=!o,l(L({connections:r,video:i,audio:!o,resolution:a,room:s})))},toggleVideo:function(){d.current.srcObject&&(d.current.srcObject.getVideoTracks()[0].enabled=!i,l(L({connections:r,audio:o,video:!i,resolution:a,room:s})))},toggleView:function(){A("sidebar"===M?"tiles":"sidebar")},hangup:function(){return ue(!0)},connections:r,localStreamRef:d,remoteStreamRefs:p,statsIsOpen:H,openStats:function(e){return function(e){K&&clearInterval(K);var t=setInterval(Object(h.a)(f.a.mark((function t(){var n,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!j.current[e]){t.next=5;break}return t.next=3,j.current[e].getStats(null).then((function(e){return e}),(function(e){return e.toString()}));case 3:c=t.sent,n=c;case 5:q(n);case 6:case"end":return t.stop()}}),t)}))),1e3);_(t),P(!0)}(e)},closeStats:function(){clearInterval(K),P(!1),_(null)},statMessages:W})})),oe=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(E.jsx)(re,{})}}]),n}(r.a.Component);n(156);var ie=function(){return Object(E.jsxs)(a.a,{basename:"/rtc-test-app",hashType:"noslash",children:[Object(E.jsx)(s.a,{exact:!0,path:"/",component:z}),Object(E.jsx)(s.a,{exact:!0,path:"/test",component:oe})]})},ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,222)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),o(e),i(e)}))},se=n(38),ue=Object(se.combineReducers)({rtc:U}),le=function(e,t){return ue(e,t)},de=n(99),je=Object(se.createStore)(le,Object(de.composeWithDevTools)());i.a.render(Object(E.jsx)(m.a,{store:je,children:Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsx)(ie,{})})}),document.getElementById("root")),ae()}},[[157,1,2]]]);
//# sourceMappingURL=main.a8df1ba2.chunk.js.map